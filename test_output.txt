============================= test session starts ==============================
platform darwin -- Python 3.13.5, pytest-8.4.2, pluggy-1.6.0 -- /Users/pawkumar/Documents/pawan/DualMind/.venv/bin/python
cachedir: .pytest_cache
rootdir: /Users/pawkumar/Documents/pawan/DualMind
configfile: pytest.ini
plugins: mock-3.15.1, asyncio-1.2.0, anyio-4.11.0, langsmith-0.4.39, cov-7.0.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 74 items

tests/integration/test_client_rag.py::TestClientRAGEndpoints::test_embedding_models_endpoint FAILED [  1%]
tests/integration/test_client_rag.py::TestClientRAGEndpoints::test_embedding_model_categories FAILED [  2%]
tests/integration/test_client_rag.py::TestLocalModeRAGUI::test_local_mode_has_rag_elements PASSED [  4%]
tests/integration/test_client_rag.py::TestLocalModeRAGUI::test_local_mode_has_rag_modal PASSED [  5%]
tests/integration/test_client_rag.py::TestLocalModeRAGUI::test_local_mode_rag_scripts FAILED [  6%]
tests/integration/test_client_rag.py::TestCloudModeRAGUI::test_cloud_mode_has_rag_elements PASSED [  8%]
tests/integration/test_client_rag.py::TestCloudModeRAGUI::test_cloud_mode_has_document_management PASSED [  9%]
tests/integration/test_client_rag.py::TestRAGStaticAssets::test_rag_js_module_exists PASSED [ 10%]
tests/integration/test_client_rag.py::TestRAGStaticAssets::test_embedding_models_json_exists PASSED [ 12%]
tests/integration/test_client_rag.py::TestRAGStaticAssets::test_rag_css_integration PASSED [ 13%]
tests/integration/test_client_rag.py::TestRAGFeatureIntegration::test_local_and_cloud_rag_parity PASSED [ 14%]
tests/integration/test_client_rag.py::TestRAGFeatureIntegration::test_rag_documentation_exists PASSED [ 16%]
tests/integration/test_client_rag.py::TestRAGUserFlow::test_embedding_model_selection_flow FAILED [ 17%]
tests/integration/test_client_rag.py::TestRAGUserFlow::test_rag_ui_accessibility PASSED [ 18%]
tests/ui/test_ui.py::TestLandingPage::test_landing_page_loads PASSED     [ 20%]
tests/ui/test_ui.py::TestLandingPage::test_landing_page_contains_branding PASSED [ 21%]
tests/ui/test_ui.py::TestLandingPage::test_landing_page_has_mode_selection PASSED [ 22%]
tests/ui/test_ui.py::TestLocalModeUI::test_local_mode_loads PASSED       [ 24%]
tests/ui/test_ui.py::TestLocalModeUI::test_local_mode_has_chat_elements PASSED [ 25%]
tests/ui/test_ui.py::TestLocalModeUI::test_local_mode_has_webllm_import PASSED [ 27%]
tests/ui/test_ui.py::TestLocalModeUI::test_local_mode_has_transformers PASSED [ 28%]
tests/ui/test_ui.py::TestLocalModeUI::test_local_mode_has_markdown_support PASSED [ 29%]
tests/ui/test_ui.py::TestLocalModeUI::test_local_mode_has_code_highlighting PASSED [ 31%]
tests/ui/test_ui.py::TestCloudModeUI::test_cloud_mode_loads PASSED       [ 32%]
tests/ui/test_ui.py::TestCloudModeUI::test_cloud_mode_has_provider_selection PASSED [ 33%]
tests/ui/test_ui.py::TestCloudModeUI::test_cloud_mode_has_chat_elements PASSED [ 35%]
tests/ui/test_ui.py::TestModularLocalUI::test_local_html_loads PASSED    [ 36%]
tests/ui/test_ui.py::TestModularLocalUI::test_local_ui_has_sidebar PASSED [ 37%]
tests/ui/test_ui.py::TestModularLocalUI::test_local_ui_has_chat_history PASSED [ 39%]
tests/ui/test_ui.py::TestModularLocalUI::test_local_ui_has_model_selector PASSED [ 40%]
tests/ui/test_ui.py::TestModularLocalUI::test_local_ui_uses_modular_js PASSED [ 41%]
tests/ui/test_ui.py::TestModularLocalUI::test_local_ui_uses_modular_css PASSED [ 43%]
tests/ui/test_ui.py::TestModularJavaScript::test_app_js_exists PASSED    [ 44%]
tests/ui/test_ui.py::TestModularJavaScript::test_config_js_exists PASSED [ 45%]
tests/ui/test_ui.py::TestModularJavaScript::test_ui_js_exists PASSED     [ 47%]
tests/ui/test_ui.py::TestModularJavaScript::test_chat_js_exists PASSED   [ 48%]
tests/ui/test_ui.py::TestModularJavaScript::test_models_js_exists PASSED [ 50%]
tests/ui/test_ui.py::TestModularJavaScript::test_rag_js_exists PASSED    [ 51%]
tests/ui/test_ui.py::TestModularJavaScript::test_storage_js_exists PASSED [ 52%]
tests/ui/test_ui.py::TestModularCSS::test_local_css_exists PASSED        [ 54%]
tests/ui/test_ui.py::TestModularCSS::test_local_css_has_modern_features PASSED [ 55%]
tests/ui/test_ui.py::TestStaticAssets::test_embedding_models_json PASSED [ 56%]
tests/ui/test_ui.py::TestStaticAssets::test_local_html_accessible PASSED [ 58%]
tests/ui/test_ui.py::TestResponsiveDesign::test_local_mode_has_viewport_meta PASSED [ 59%]
tests/ui/test_ui.py::TestResponsiveDesign::test_enhanced_ui_has_media_queries PASSED [ 60%]
tests/ui/test_ui.py::TestAccessibility::test_ui_has_semantic_html PASSED [ 62%]
tests/ui/test_ui.py::TestAccessibility::test_buttons_have_labels PASSED  [ 63%]
tests/ui/test_ui.py::TestJavaScriptFunctionality::test_local_mode_has_send_function PASSED [ 64%]
tests/ui/test_ui.py::TestJavaScriptFunctionality::test_enhanced_ui_has_essential_functions PASSED [ 66%]
tests/ui/test_ui.py::TestJavaScriptFunctionality::test_ui_has_event_handlers PASSED [ 67%]
tests/ui/test_ui.py::TestDarkMode::test_enhanced_ui_has_dark_mode_styling PASSED [ 68%]
tests/ui/test_ui.py::TestErrorHandling::test_404_handling PASSED         [ 70%]
tests/ui/test_ui.py::TestErrorHandling::test_invalid_static_file PASSED  [ 71%]
tests/unit/test_server.py::TestHealthEndpoint::test_health_check_status PASSED [ 72%]
tests/unit/test_server.py::TestHealthEndpoint::test_health_check_content PASSED [ 74%]
tests/unit/test_server.py::TestProviderEndpoints::test_get_all_providers PASSED [ 75%]
tests/unit/test_server.py::TestProviderEndpoints::test_provider_structure PASSED [ 77%]
tests/unit/test_server.py::TestProviderEndpoints::test_get_provider_models_google PASSED [ 78%]
tests/unit/test_server.py::TestProviderEndpoints::test_get_provider_models_openai PASSED [ 79%]
tests/unit/test_server.py::TestProviderEndpoints::test_get_provider_models_invalid PASSED [ 81%]
tests/unit/test_server.py::TestEmbeddingEndpoints::test_get_embedding_providers PASSED [ 82%]
tests/unit/test_server.py::TestEmbeddingEndpoints::test_embedding_provider_structure PASSED [ 83%]
tests/unit/test_server.py::TestEmbeddingEndpoints::test_get_embedding_models_openai PASSED [ 85%]
tests/unit/test_server.py::TestEmbeddingEndpoints::test_get_embedding_models_google PASSED [ 86%]
tests/unit/test_server.py::TestEmbeddingEndpoints::test_get_embedding_models_invalid PASSED [ 87%]
tests/unit/test_server.py::TestEmbeddingEndpoints::test_get_local_embedding_models PASSED [ 89%]
tests/unit/test_server.py::TestUIEndpoints::test_root_endpoint PASSED    [ 90%]
tests/unit/test_server.py::TestUIEndpoints::test_local_mode_endpoint PASSED [ 91%]
tests/unit/test_server.py::TestUIEndpoints::test_static_files PASSED     [ 93%]
tests/unit/test_server.py::TestRAGDocumentEndpoints::test_get_documents_empty PASSED [ 94%]
tests/unit/test_server.py::TestRAGDocumentEndpoints::test_upload_document PASSED [ 95%]
tests/unit/test_server.py::TestRAGDocumentEndpoints::test_delete_all_documents PASSED [ 97%]
tests/unit/test_server.py::TestChatEndpoint::test_chat_missing_api_key FAILED [ 98%]
tests/unit/test_server.py::TestChatEndpoint::test_chat_invalid_provider FAILED [100%]

=================================== FAILURES ===================================
____________ TestClientRAGEndpoints.test_embedding_models_endpoint _____________
tests/integration/test_client_rag.py:25: in test_embedding_models_endpoint
    assert "transformers_js" in data
E   AssertionError: assert 'transformers_js' in {'source': 'Hugging Face Transformers.js', 'models': [{'id': 'Xenova/all-MiniLM-L6-v2', 'name': 'all-MiniLM-L6-v2', 'description': 'Fast, lightweight (22MB)', 'size_mb': 22, 'dimensions': 384, 'category': 'speed', 'languages': ['en'], 'recommended': True}, {'id': 'Xenova/all-mpnet-base-v2', 'name': 'all-mpnet-base-v2', 'description': 'Better quality (80MB)', 'size_mb': 80, 'dimensions': 768, 'category': 'quality', 'languages': ['en']}, {'id': 'Xenova/bge-small-en-v1.5', 'name': 'BGE-small-en-v1.5', 'description': 'Fast, good quality (33MB)', 'size_mb': 33, 'dimensions': 384, 'category': 'speed', 'languages': ['en']}, {'id': 'Xenova/bge-base-en-v1.5', 'name': 'BGE-base-en-v1.5', 'description': 'High quality (109MB)', 'size_mb': 109, 'dimensions': 768, 'category': 'quality', 'languages': ['en']}, {'id': 'Xenova/gte-small', 'name': 'GTE-small', 'description': 'Multilingual (33MB)', 'size_mb': 33, 'dimensions': 384, 'category': 'multilingual', 'languages': ['multi']}, {'id': 'Xenova/multilingual-e5-small', 'name': 'E5-small-multilingual', 'description': 'Best multilingual (118MB)', 'size_mb': 118, 'dimensions': 384, 'category': 'multilingual', 'languages': ['multi']}, {'id': 'Xenova/paraphrase-multilingual-MiniLM-L12-v2', 'name': 'Paraphrase-multilingual-MiniLM', 'description': 'Multilingual paraphrase (118MB)', 'size_mb': 118, 'dimensions': 384, 'category': 'multilingual', 'languages': ['multi']}, {'id': 'Xenova/gte-base', 'name': 'GTE-base', 'description': 'Better multilingual (218MB)', 'size_mb': 218, 'dimensions': 768, 'category': 'multilingual', 'languages': ['multi']}]}
____________ TestClientRAGEndpoints.test_embedding_model_categories ____________
tests/integration/test_client_rag.py:41: in test_embedding_model_categories
    models = data["transformers_js"]["models"]
             ^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'transformers_js'
________________ TestLocalModeRAGUI.test_local_mode_rag_scripts ________________
tests/integration/test_client_rag.py:83: in test_local_mode_rag_scripts
    assert "rag.js" in content or "rag" in content.lower()
E   assert ('rag.js' in '<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>DualMind AI - Local Mode</title>\n    \n    <!-- External Libraries -->\n    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/core.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/javascript.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/python.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/java.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/cpp.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/xml.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/css.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/json.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/bash.min.js"></script>\n    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css">\n    \n    <!-- DualMind Styles -->\n    <link rel="stylesheet" href="/static/css/local.css">\n    \n    <!-- Initialize WebLLM and Transformers.js -->\n    <script type="module">\n        import { CreateMLCEngine } from "https://esm.run/@mlc-ai/web-llm";\n        window.CreateMLCEngine = CreateMLCEngine;\n        \n        import { pipeline, env } from \'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.1\';\n        env.allowLocalModels = false;\n        window.transformers = { pipeline, env };\n        \n        // Configure marked for code highlighting\n        marked.setOptions({\n            highlight: function(code, lang) {\n                if (lang && hljs.getLanguage(lang)) {\n                    try {\n                        return hljs.highlight(code, { language: lang }).value;\n                    } catch (err) {}\n                }\n                return hljs.highlightAuto(code).value;\n            },\n            breaks: true,\n            gfm: true\n        });\n    </script>\n</head>\n<body>\n    <div class="app-container">\n        <!-- Sidebar -->\n        <div class="sidebar">\n            <div class="sidebar-header">\n                <button class="new-chat-btn" onclick="dualmind.openNewChatModal()" title="Create new chat">\n                    <span>\U0001f4ac</span>\n                    <span>New chat</span>\n                </button>\n            </div>\n            \n            <div class="chat-history">\n                <div class="chat-history-title">Your chats</div>\n                <div id="chatHistoryList"></div>\n            </div>\n            \n            <div class="sidebar-footer">\n                <div class="user-avatar">DM</div>\n                <div class="user-name">DualMind User</div>\n            </div>\n        </div>\n        \n        <!-- Main Content -->\n        <div class="main-content">\n            <!-- Header -->\n            <div class="chat-header">\n                <div class="model-selector" onclick="dualmind.openModelSelector()">\n                    <div class="model-icon">\U0001f916</div>\n                    <div class="model-info">\n                        <h3 id="currentModelName">Select Model</h3>\n                        <p id="currentModelDesc">Click to choose a model</p>\n                    </div>\n                </div>\n                \n                <div class="header-actions">\n                    <button class="header-btn" onclick="dualmind.openSettings()" title="Settings">\u2699\ufe0f</button>\n                    <button class="header-btn" onclick="dualmind.exportChat()" title="Export">\u2b07\ufe0f</button>\n                    <button class="header-btn" onclick="dualmind.switchToCloudMode()" title="Cloud Mode">\u2601\ufe0f</button>\n                </div>\n            </div>\n            \n            <!-- Messages -->\n            <div class="chat-messages" id="chatMessages">\n                <div class="empty-state">\n                    <div class="empty-state-icon">\U0001f4ac</div>\n                    <h1>How can I help you today?</h1>\n                    <p>Select a model to start chatting. Your AI runs privately in your browser with no data sent to servers.</p>\n                </div>\n            </div>\n            \n            <!-- Input -->\n            <div class="chat-input-container">\n                <div class="input-wrapper">\n                    <span class="attach-icon" onclick="dualmind.openKnowledgeBase()" title="Add documents">\U0001f4ce</span>\n                    <textarea \n                        class="chat-input" \n                        id="userInput" \n                        placeholder="Enter your prompt here"\n                        rows="1"\n                    ></textarea>\n                    <div class="input-actions">\n                        <button class="input-btn" id="voiceBtn" onclick="dualmind.toggleVoice()" title="Voice input">\U0001f3a4</button>\n                        <button class="input-btn primary" id="sendBtn" onclick="dualmind.sendMessage()" disabled title="Send">\u27a4</button>\n                    </div>\n                </div>\n                <div class="input-hint">\n                    Press Enter to send, Shift+Enter for new line\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- Model Selector Modal -->\n    <div class="modal" id="modelModal">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h2>Select Model</h2>\n                <button class="close-modal" onclick="dualmind.closeModelSelector()">\xd7</button>\n            </div>\n            <div class="model-list" id="modelList"></div>\n        </div>\n    </div>\n    \n    <!-- Knowledge Base Modal -->\n    <div class="modal" id="knowledgeModal">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h2>\U0001f4da Knowledge Base</h2>\n                <button class="close-modal" onclick="dualmind.closeKnowledgeBase()">\xd7</button>\n            </div>\n            <div id="knowledgeContent">\n                <p style="color: #999; margin-bottom: 16px;">\n                    Upload documents to enhance AI responses with your own data.\n                </p>\n                <input type="file" id="fileInput" multiple style="display: none;" \n                       onchange="dualmind.handleFileUpload(event)">\n                <button class="new-chat-btn" onclick="document.getElementById(\'fileInput\').click()">\n                    \U0001f4c4 Upload Documents\n                </button>\n                <div id="uploadedFiles" style="margin-top: 16px;"></div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- Settings Modal -->\n    <div class="modal" id="settingsModal">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h2>\u2699\ufe0f Settings</h2>\n                <button class="close-modal" onclick="dualmind.closeSettings()">\xd7</button>\n            </div>\n            <div class="settings-content">\n                <div class="setting-group">\n                    <label class="setting-label">\n                        <span>\U0001f319 Dark Mode</span>\n                        <label class="switch">\n                            <input type="checkbox" id="darkModeToggle" onchange="dualmind.toggleDarkMode()">\n                            <span class="slider"></span>\n                        </label>\n                    </label>\n                </div>\n                \n                <div class="setting-group">\n                    <label class="setting-label">\U0001f4ad Custom Memory</label>\n                    <textarea \n                        id="customMemoryInput" \n                        class="setting-textarea"\n                        placeholder="Add custom instructions that will be included in every conversation (e.g., \'You are a helpful coding assistant\')"\n                        rows="4"\n                    ></textarea>\n                    <button class="save-btn" onclick="dualmind.saveCustomMemory()">\U0001f4be Save Memory</button>\n                </div>\n                \n                <div class="setting-group">\n                    <label class="setting-label">\U0001f4c1 Chat Context (Current Chat)</label>\n                    <textarea \n                        id="chatContextInput" \n                        class="setting-textarea"\n                        placeholder="Add context/instructions specific to this chat (e.g., \'Focus on Python programming\')"\n                        rows="3"\n                    ></textarea>\n                    <button class="save-btn" onclick="dualmind.saveChatContext()">\U0001f4be Save Context</button>\n                    <p style="font-size: 12px; color: #999; margin-top: 8px;">\n                        This context applies only to the current chat session\n                    </p>\n                </div>\n                \n                <div class="setting-group">\n                    <button class="danger-btn" onclick="dualmind.clearAllChats()">\n                        \U0001f5d1\ufe0f Clear All Chat History\n                    </button>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- Chat Actions Menu (Context Menu) -->\n    <div class="context-menu" id="chatContextMenu" style="display: none;">\n        <button class="context-menu-item" onclick="dualmind.renameChatPrompt()">\u270f\ufe0f Rename</button>\n        <button class="context-menu-item" onclick="dualmind.deleteChatPrompt()">\U0001f5d1\ufe0f Delete</button>\n    </div>\n    \n    <!-- New Chat Modal -->\n    <div class="modal" id="newChatModal">\n        <div class="modal-content small">\n            <div class="modal-header">\n                <h2>\U0001f4ac New Chat</h2>\n                <button class="close-modal" onclick="dualmind.closeNewChatModal()">\xd7</button>\n            </div>\n            <div style="padding: 20px;">\n                <label class="setting-label">Chat Name (Optional)</label>\n                <input \n                    type="text" \n                    id="newChatNameInput" \n                    class="chat-name-input"\n                    placeholder="Leave empty to use first message"\n                    style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px;"\n                >\n                <div style="display: flex; gap: 10px; margin-top: 20px;">\n                    <button class="save-btn" onclick="dualmind.createNewChat()">\u2705 Create</button>\n                    <button class="cancel-btn" onclick="dualmind.closeNewChatModal()">\u274c Cancel</button>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- DualMind Application -->\n    <script type="module" src="/static/js/app.js"></script>\n</body>\n</html>\n\n' or 'rag' in '<!doctype html>\n<html lang="en">\n<head>\n    <meta charset="utf-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>dualmind ai - local mode</title>\n    \n    <!-- external libraries -->\n    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/core.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/javascript.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/python.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/java.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/cpp.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/xml.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/css.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/json.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/bash.min.js"></script>\n    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css">\n    \n    <!-- dualmind styles -->\n    <link rel="stylesheet" href="/static/css/local.css">\n    \n    <!-- initialize webllm and transformers.js -->\n    <script type="module">\n        import { createmlcengine } from "https://esm.run/@mlc-ai/web-llm";\n        window.createmlcengine = createmlcengine;\n        \n        import { pipeline, env } from \'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.1\';\n        env.allowlocalmodels = false;\n        window.transformers = { pipeline, env };\n        \n        // configure marked for code highlighting\n        marked.setoptions({\n            highlight: function(code, lang) {\n                if (lang && hljs.getlanguage(lang)) {\n                    try {\n                        return hljs.highlight(code, { language: lang }).value;\n                    } catch (err) {}\n                }\n                return hljs.highlightauto(code).value;\n            },\n            breaks: true,\n            gfm: true\n        });\n    </script>\n</head>\n<body>\n    <div class="app-container">\n        <!-- sidebar -->\n        <div class="sidebar">\n            <div class="sidebar-header">\n                <button class="new-chat-btn" onclick="dualmind.opennewchatmodal()" title="create new chat">\n                    <span>\U0001f4ac</span>\n                    <span>new chat</span>\n                </button>\n            </div>\n            \n            <div class="chat-history">\n                <div class="chat-history-title">your chats</div>\n                <div id="chathistorylist"></div>\n            </div>\n            \n            <div class="sidebar-footer">\n                <div class="user-avatar">dm</div>\n                <div class="user-name">dualmind user</div>\n            </div>\n        </div>\n        \n        <!-- main content -->\n        <div class="main-content">\n            <!-- header -->\n            <div class="chat-header">\n                <div class="model-selector" onclick="dualmind.openmodelselector()">\n                    <div class="model-icon">\U0001f916</div>\n                    <div class="model-info">\n                        <h3 id="currentmodelname">select model</h3>\n                        <p id="currentmodeldesc">click to choose a model</p>\n                    </div>\n                </div>\n                \n                <div class="header-actions">\n                    <button class="header-btn" onclick="dualmind.opensettings()" title="settings">\u2699\ufe0f</button>\n                    <button class="header-btn" onclick="dualmind.exportchat()" title="export">\u2b07\ufe0f</button>\n                    <button class="header-btn" onclick="dualmind.switchtocloudmode()" title="cloud mode">\u2601\ufe0f</button>\n                </div>\n            </div>\n            \n            <!-- messages -->\n            <div class="chat-messages" id="chatmessages">\n                <div class="empty-state">\n                    <div class="empty-state-icon">\U0001f4ac</div>\n                    <h1>how can i help you today?</h1>\n                    <p>select a model to start chatting. your ai runs privately in your browser with no data sent to servers.</p>\n                </div>\n            </div>\n            \n            <!-- input -->\n            <div class="chat-input-container">\n                <div class="input-wrapper">\n                    <span class="attach-icon" onclick="dualmind.openknowledgebase()" title="add documents">\U0001f4ce</span>\n                    <textarea \n                        class="chat-input" \n                        id="userinput" \n                        placeholder="enter your prompt here"\n                        rows="1"\n                    ></textarea>\n                    <div class="input-actions">\n                        <button class="input-btn" id="voicebtn" onclick="dualmind.togglevoice()" title="voice input">\U0001f3a4</button>\n                        <button class="input-btn primary" id="sendbtn" onclick="dualmind.sendmessage()" disabled title="send">\u27a4</button>\n                    </div>\n                </div>\n                <div class="input-hint">\n                    press enter to send, shift+enter for new line\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- model selector modal -->\n    <div class="modal" id="modelmodal">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h2>select model</h2>\n                <button class="close-modal" onclick="dualmind.closemodelselector()">\xd7</button>\n            </div>\n            <div class="model-list" id="modellist"></div>\n        </div>\n    </div>\n    \n    <!-- knowledge base modal -->\n    <div class="modal" id="knowledgemodal">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h2>\U0001f4da knowledge base</h2>\n                <button class="close-modal" onclick="dualmind.closeknowledgebase()">\xd7</button>\n            </div>\n            <div id="knowledgecontent">\n                <p style="color: #999; margin-bottom: 16px;">\n                    upload documents to enhance ai responses with your own data.\n                </p>\n                <input type="file" id="fileinput" multiple style="display: none;" \n                       onchange="dualmind.handlefileupload(event)">\n                <button class="new-chat-btn" onclick="document.getelementbyid(\'fileinput\').click()">\n                    \U0001f4c4 upload documents\n                </button>\n                <div id="uploadedfiles" style="margin-top: 16px;"></div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- settings modal -->\n    <div class="modal" id="settingsmodal">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h2>\u2699\ufe0f settings</h2>\n                <button class="close-modal" onclick="dualmind.closesettings()">\xd7</button>\n            </div>\n            <div class="settings-content">\n                <div class="setting-group">\n                    <label class="setting-label">\n                        <span>\U0001f319 dark mode</span>\n                        <label class="switch">\n                            <input type="checkbox" id="darkmodetoggle" onchange="dualmind.toggledarkmode()">\n                            <span class="slider"></span>\n                        </label>\n                    </label>\n                </div>\n                \n                <div class="setting-group">\n                    <label class="setting-label">\U0001f4ad custom memory</label>\n                    <textarea \n                        id="custommemoryinput" \n                        class="setting-textarea"\n                        placeholder="add custom instructions that will be included in every conversation (e.g., \'you are a helpful coding assistant\')"\n                        rows="4"\n                    ></textarea>\n                    <button class="save-btn" onclick="dualmind.savecustommemory()">\U0001f4be save memory</button>\n                </div>\n                \n                <div class="setting-group">\n                    <label class="setting-label">\U0001f4c1 chat context (current chat)</label>\n                    <textarea \n                        id="chatcontextinput" \n                        class="setting-textarea"\n                        placeholder="add context/instructions specific to this chat (e.g., \'focus on python programming\')"\n                        rows="3"\n                    ></textarea>\n                    <button class="save-btn" onclick="dualmind.savechatcontext()">\U0001f4be save context</button>\n                    <p style="font-size: 12px; color: #999; margin-top: 8px;">\n                        this context applies only to the current chat session\n                    </p>\n                </div>\n                \n                <div class="setting-group">\n                    <button class="danger-btn" onclick="dualmind.clearallchats()">\n                        \U0001f5d1\ufe0f clear all chat history\n                    </button>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- chat actions menu (context menu) -->\n    <div class="context-menu" id="chatcontextmenu" style="display: none;">\n        <button class="context-menu-item" onclick="dualmind.renamechatprompt()">\u270f\ufe0f rename</button>\n        <button class="context-menu-item" onclick="dualmind.deletechatprompt()">\U0001f5d1\ufe0f delete</button>\n    </div>\n    \n    <!-- new chat modal -->\n    <div class="modal" id="newchatmodal">\n        <div class="modal-content small">\n            <div class="modal-header">\n                <h2>\U0001f4ac new chat</h2>\n                <button class="close-modal" onclick="dualmind.closenewchatmodal()">\xd7</button>\n            </div>\n            <div style="padding: 20px;">\n                <label class="setting-label">chat name (optional)</label>\n                <input \n                    type="text" \n                    id="newchatnameinput" \n                    class="chat-name-input"\n                    placeholder="leave empty to use first message"\n                    style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px;"\n                >\n                <div style="display: flex; gap: 10px; margin-top: 20px;">\n                    <button class="save-btn" onclick="dualmind.createnewchat()">\u2705 create</button>\n                    <button class="cancel-btn" onclick="dualmind.closenewchatmodal()">\u274c cancel</button>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- dualmind application -->\n    <script type="module" src="/static/js/app.js"></script>\n</body>\n</html>\n\n')
E    +  where '<!doctype html>\n<html lang="en">\n<head>\n    <meta charset="utf-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>dualmind ai - local mode</title>\n    \n    <!-- external libraries -->\n    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/core.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/javascript.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/python.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/java.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/cpp.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/xml.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/css.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/json.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/bash.min.js"></script>\n    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css">\n    \n    <!-- dualmind styles -->\n    <link rel="stylesheet" href="/static/css/local.css">\n    \n    <!-- initialize webllm and transformers.js -->\n    <script type="module">\n        import { createmlcengine } from "https://esm.run/@mlc-ai/web-llm";\n        window.createmlcengine = createmlcengine;\n        \n        import { pipeline, env } from \'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.1\';\n        env.allowlocalmodels = false;\n        window.transformers = { pipeline, env };\n        \n        // configure marked for code highlighting\n        marked.setoptions({\n            highlight: function(code, lang) {\n                if (lang && hljs.getlanguage(lang)) {\n                    try {\n                        return hljs.highlight(code, { language: lang }).value;\n                    } catch (err) {}\n                }\n                return hljs.highlightauto(code).value;\n            },\n            breaks: true,\n            gfm: true\n        });\n    </script>\n</head>\n<body>\n    <div class="app-container">\n        <!-- sidebar -->\n        <div class="sidebar">\n            <div class="sidebar-header">\n                <button class="new-chat-btn" onclick="dualmind.opennewchatmodal()" title="create new chat">\n                    <span>\U0001f4ac</span>\n                    <span>new chat</span>\n                </button>\n            </div>\n            \n            <div class="chat-history">\n                <div class="chat-history-title">your chats</div>\n                <div id="chathistorylist"></div>\n            </div>\n            \n            <div class="sidebar-footer">\n                <div class="user-avatar">dm</div>\n                <div class="user-name">dualmind user</div>\n            </div>\n        </div>\n        \n        <!-- main content -->\n        <div class="main-content">\n            <!-- header -->\n            <div class="chat-header">\n                <div class="model-selector" onclick="dualmind.openmodelselector()">\n                    <div class="model-icon">\U0001f916</div>\n                    <div class="model-info">\n                        <h3 id="currentmodelname">select model</h3>\n                        <p id="currentmodeldesc">click to choose a model</p>\n                    </div>\n                </div>\n                \n                <div class="header-actions">\n                    <button class="header-btn" onclick="dualmind.opensettings()" title="settings">\u2699\ufe0f</button>\n                    <button class="header-btn" onclick="dualmind.exportchat()" title="export">\u2b07\ufe0f</button>\n                    <button class="header-btn" onclick="dualmind.switchtocloudmode()" title="cloud mode">\u2601\ufe0f</button>\n                </div>\n            </div>\n            \n            <!-- messages -->\n            <div class="chat-messages" id="chatmessages">\n                <div class="empty-state">\n                    <div class="empty-state-icon">\U0001f4ac</div>\n                    <h1>how can i help you today?</h1>\n                    <p>select a model to start chatting. your ai runs privately in your browser with no data sent to servers.</p>\n                </div>\n            </div>\n            \n            <!-- input -->\n            <div class="chat-input-container">\n                <div class="input-wrapper">\n                    <span class="attach-icon" onclick="dualmind.openknowledgebase()" title="add documents">\U0001f4ce</span>\n                    <textarea \n                        class="chat-input" \n                        id="userinput" \n                        placeholder="enter your prompt here"\n                        rows="1"\n                    ></textarea>\n                    <div class="input-actions">\n                        <button class="input-btn" id="voicebtn" onclick="dualmind.togglevoice()" title="voice input">\U0001f3a4</button>\n                        <button class="input-btn primary" id="sendbtn" onclick="dualmind.sendmessage()" disabled title="send">\u27a4</button>\n                    </div>\n                </div>\n                <div class="input-hint">\n                    press enter to send, shift+enter for new line\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- model selector modal -->\n    <div class="modal" id="modelmodal">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h2>select model</h2>\n                <button class="close-modal" onclick="dualmind.closemodelselector()">\xd7</button>\n            </div>\n            <div class="model-list" id="modellist"></div>\n        </div>\n    </div>\n    \n    <!-- knowledge base modal -->\n    <div class="modal" id="knowledgemodal">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h2>\U0001f4da knowledge base</h2>\n                <button class="close-modal" onclick="dualmind.closeknowledgebase()">\xd7</button>\n            </div>\n            <div id="knowledgecontent">\n                <p style="color: #999; margin-bottom: 16px;">\n                    upload documents to enhance ai responses with your own data.\n                </p>\n                <input type="file" id="fileinput" multiple style="display: none;" \n                       onchange="dualmind.handlefileupload(event)">\n                <button class="new-chat-btn" onclick="document.getelementbyid(\'fileinput\').click()">\n                    \U0001f4c4 upload documents\n                </button>\n                <div id="uploadedfiles" style="margin-top: 16px;"></div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- settings modal -->\n    <div class="modal" id="settingsmodal">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h2>\u2699\ufe0f settings</h2>\n                <button class="close-modal" onclick="dualmind.closesettings()">\xd7</button>\n            </div>\n            <div class="settings-content">\n                <div class="setting-group">\n                    <label class="setting-label">\n                        <span>\U0001f319 dark mode</span>\n                        <label class="switch">\n                            <input type="checkbox" id="darkmodetoggle" onchange="dualmind.toggledarkmode()">\n                            <span class="slider"></span>\n                        </label>\n                    </label>\n                </div>\n                \n                <div class="setting-group">\n                    <label class="setting-label">\U0001f4ad custom memory</label>\n                    <textarea \n                        id="custommemoryinput" \n                        class="setting-textarea"\n                        placeholder="add custom instructions that will be included in every conversation (e.g., \'you are a helpful coding assistant\')"\n                        rows="4"\n                    ></textarea>\n                    <button class="save-btn" onclick="dualmind.savecustommemory()">\U0001f4be save memory</button>\n                </div>\n                \n                <div class="setting-group">\n                    <label class="setting-label">\U0001f4c1 chat context (current chat)</label>\n                    <textarea \n                        id="chatcontextinput" \n                        class="setting-textarea"\n                        placeholder="add context/instructions specific to this chat (e.g., \'focus on python programming\')"\n                        rows="3"\n                    ></textarea>\n                    <button class="save-btn" onclick="dualmind.savechatcontext()">\U0001f4be save context</button>\n                    <p style="font-size: 12px; color: #999; margin-top: 8px;">\n                        this context applies only to the current chat session\n                    </p>\n                </div>\n                \n                <div class="setting-group">\n                    <button class="danger-btn" onclick="dualmind.clearallchats()">\n                        \U0001f5d1\ufe0f clear all chat history\n                    </button>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- chat actions menu (context menu) -->\n    <div class="context-menu" id="chatcontextmenu" style="display: none;">\n        <button class="context-menu-item" onclick="dualmind.renamechatprompt()">\u270f\ufe0f rename</button>\n        <button class="context-menu-item" onclick="dualmind.deletechatprompt()">\U0001f5d1\ufe0f delete</button>\n    </div>\n    \n    <!-- new chat modal -->\n    <div class="modal" id="newchatmodal">\n        <div class="modal-content small">\n            <div class="modal-header">\n                <h2>\U0001f4ac new chat</h2>\n                <button class="close-modal" onclick="dualmind.closenewchatmodal()">\xd7</button>\n            </div>\n            <div style="padding: 20px;">\n                <label class="setting-label">chat name (optional)</label>\n                <input \n                    type="text" \n                    id="newchatnameinput" \n                    class="chat-name-input"\n                    placeholder="leave empty to use first message"\n                    style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px;"\n                >\n                <div style="display: flex; gap: 10px; margin-top: 20px;">\n                    <button class="save-btn" onclick="dualmind.createnewchat()">\u2705 create</button>\n                    <button class="cancel-btn" onclick="dualmind.closenewchatmodal()">\u274c cancel</button>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- dualmind application -->\n    <script type="module" src="/static/js/app.js"></script>\n</body>\n</html>\n\n' = <built-in method lower of str object at 0x952b54000>()
E    +    where <built-in method lower of str object at 0x952b54000> = '<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>DualMind AI - Local Mode</title>\n    \n    <!-- External Libraries -->\n    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/core.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/javascript.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/python.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/java.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/cpp.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/xml.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/css.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/json.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/bash.min.js"></script>\n    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css">\n    \n    <!-- DualMind Styles -->\n    <link rel="stylesheet" href="/static/css/local.css">\n    \n    <!-- Initialize WebLLM and Transformers.js -->\n    <script type="module">\n        import { CreateMLCEngine } from "https://esm.run/@mlc-ai/web-llm";\n        window.CreateMLCEngine = CreateMLCEngine;\n        \n        import { pipeline, env } from \'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.1\';\n        env.allowLocalModels = false;\n        window.transformers = { pipeline, env };\n        \n        // Configure marked for code highlighting\n        marked.setOptions({\n            highlight: function(code, lang) {\n                if (lang && hljs.getLanguage(lang)) {\n                    try {\n                        return hljs.highlight(code, { language: lang }).value;\n                    } catch (err) {}\n                }\n                return hljs.highlightAuto(code).value;\n            },\n            breaks: true,\n            gfm: true\n        });\n    </script>\n</head>\n<body>\n    <div class="app-container">\n        <!-- Sidebar -->\n        <div class="sidebar">\n            <div class="sidebar-header">\n                <button class="new-chat-btn" onclick="dualmind.openNewChatModal()" title="Create new chat">\n                    <span>\U0001f4ac</span>\n                    <span>New chat</span>\n                </button>\n            </div>\n            \n            <div class="chat-history">\n                <div class="chat-history-title">Your chats</div>\n                <div id="chatHistoryList"></div>\n            </div>\n            \n            <div class="sidebar-footer">\n                <div class="user-avatar">DM</div>\n                <div class="user-name">DualMind User</div>\n            </div>\n        </div>\n        \n        <!-- Main Content -->\n        <div class="main-content">\n            <!-- Header -->\n            <div class="chat-header">\n                <div class="model-selector" onclick="dualmind.openModelSelector()">\n                    <div class="model-icon">\U0001f916</div>\n                    <div class="model-info">\n                        <h3 id="currentModelName">Select Model</h3>\n                        <p id="currentModelDesc">Click to choose a model</p>\n                    </div>\n                </div>\n                \n                <div class="header-actions">\n                    <button class="header-btn" onclick="dualmind.openSettings()" title="Settings">\u2699\ufe0f</button>\n                    <button class="header-btn" onclick="dualmind.exportChat()" title="Export">\u2b07\ufe0f</button>\n                    <button class="header-btn" onclick="dualmind.switchToCloudMode()" title="Cloud Mode">\u2601\ufe0f</button>\n                </div>\n            </div>\n            \n            <!-- Messages -->\n            <div class="chat-messages" id="chatMessages">\n                <div class="empty-state">\n                    <div class="empty-state-icon">\U0001f4ac</div>\n                    <h1>How can I help you today?</h1>\n                    <p>Select a model to start chatting. Your AI runs privately in your browser with no data sent to servers.</p>\n                </div>\n            </div>\n            \n            <!-- Input -->\n            <div class="chat-input-container">\n                <div class="input-wrapper">\n                    <span class="attach-icon" onclick="dualmind.openKnowledgeBase()" title="Add documents">\U0001f4ce</span>\n                    <textarea \n                        class="chat-input" \n                        id="userInput" \n                        placeholder="Enter your prompt here"\n                        rows="1"\n                    ></textarea>\n                    <div class="input-actions">\n                        <button class="input-btn" id="voiceBtn" onclick="dualmind.toggleVoice()" title="Voice input">\U0001f3a4</button>\n                        <button class="input-btn primary" id="sendBtn" onclick="dualmind.sendMessage()" disabled title="Send">\u27a4</button>\n                    </div>\n                </div>\n                <div class="input-hint">\n                    Press Enter to send, Shift+Enter for new line\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- Model Selector Modal -->\n    <div class="modal" id="modelModal">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h2>Select Model</h2>\n                <button class="close-modal" onclick="dualmind.closeModelSelector()">\xd7</button>\n            </div>\n            <div class="model-list" id="modelList"></div>\n        </div>\n    </div>\n    \n    <!-- Knowledge Base Modal -->\n    <div class="modal" id="knowledgeModal">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h2>\U0001f4da Knowledge Base</h2>\n                <button class="close-modal" onclick="dualmind.closeKnowledgeBase()">\xd7</button>\n            </div>\n            <div id="knowledgeContent">\n                <p style="color: #999; margin-bottom: 16px;">\n                    Upload documents to enhance AI responses with your own data.\n                </p>\n                <input type="file" id="fileInput" multiple style="display: none;" \n                       onchange="dualmind.handleFileUpload(event)">\n                <button class="new-chat-btn" onclick="document.getElementById(\'fileInput\').click()">\n                    \U0001f4c4 Upload Documents\n                </button>\n                <div id="uploadedFiles" style="margin-top: 16px;"></div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- Settings Modal -->\n    <div class="modal" id="settingsModal">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h2>\u2699\ufe0f Settings</h2>\n                <button class="close-modal" onclick="dualmind.closeSettings()">\xd7</button>\n            </div>\n            <div class="settings-content">\n                <div class="setting-group">\n                    <label class="setting-label">\n                        <span>\U0001f319 Dark Mode</span>\n                        <label class="switch">\n                            <input type="checkbox" id="darkModeToggle" onchange="dualmind.toggleDarkMode()">\n                            <span class="slider"></span>\n                        </label>\n                    </label>\n                </div>\n                \n                <div class="setting-group">\n                    <label class="setting-label">\U0001f4ad Custom Memory</label>\n                    <textarea \n                        id="customMemoryInput" \n                        class="setting-textarea"\n                        placeholder="Add custom instructions that will be included in every conversation (e.g., \'You are a helpful coding assistant\')"\n                        rows="4"\n                    ></textarea>\n                    <button class="save-btn" onclick="dualmind.saveCustomMemory()">\U0001f4be Save Memory</button>\n                </div>\n                \n                <div class="setting-group">\n                    <label class="setting-label">\U0001f4c1 Chat Context (Current Chat)</label>\n                    <textarea \n                        id="chatContextInput" \n                        class="setting-textarea"\n                        placeholder="Add context/instructions specific to this chat (e.g., \'Focus on Python programming\')"\n                        rows="3"\n                    ></textarea>\n                    <button class="save-btn" onclick="dualmind.saveChatContext()">\U0001f4be Save Context</button>\n                    <p style="font-size: 12px; color: #999; margin-top: 8px;">\n                        This context applies only to the current chat session\n                    </p>\n                </div>\n                \n                <div class="setting-group">\n                    <button class="danger-btn" onclick="dualmind.clearAllChats()">\n                        \U0001f5d1\ufe0f Clear All Chat History\n                    </button>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- Chat Actions Menu (Context Menu) -->\n    <div class="context-menu" id="chatContextMenu" style="display: none;">\n        <button class="context-menu-item" onclick="dualmind.renameChatPrompt()">\u270f\ufe0f Rename</button>\n        <button class="context-menu-item" onclick="dualmind.deleteChatPrompt()">\U0001f5d1\ufe0f Delete</button>\n    </div>\n    \n    <!-- New Chat Modal -->\n    <div class="modal" id="newChatModal">\n        <div class="modal-content small">\n            <div class="modal-header">\n                <h2>\U0001f4ac New Chat</h2>\n                <button class="close-modal" onclick="dualmind.closeNewChatModal()">\xd7</button>\n            </div>\n            <div style="padding: 20px;">\n                <label class="setting-label">Chat Name (Optional)</label>\n                <input \n                    type="text" \n                    id="newChatNameInput" \n                    class="chat-name-input"\n                    placeholder="Leave empty to use first message"\n                    style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px;"\n                >\n                <div style="display: flex; gap: 10px; margin-top: 20px;">\n                    <button class="save-btn" onclick="dualmind.createNewChat()">\u2705 Create</button>\n                    <button class="cancel-btn" onclick="dualmind.closeNewChatModal()">\u274c Cancel</button>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- DualMind Application -->\n    <script type="module" src="/static/js/app.js"></script>\n</body>\n</html>\n\n'.lower
_____________ TestRAGUserFlow.test_embedding_model_selection_flow ______________
tests/integration/test_client_rag.py:192: in test_embedding_model_selection_flow
    models = response.json()["transformers_js"]["models"]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'transformers_js'
__________________ TestChatEndpoint.test_chat_missing_api_key __________________
tests/unit/test_server.py:249: in test_chat_missing_api_key
    assert response.status_code in [400, 401, 500]
E   assert 422 in [400, 401, 500]
E    +  where 422 = <Response [422 Unprocessable Entity]>.status_code
_________________ TestChatEndpoint.test_chat_invalid_provider __________________
tests/unit/test_server.py:261: in test_chat_invalid_provider
    assert response.status_code in [400, 500]
E   assert 200 in [400, 500]
E    +  where 200 = <Response [200 OK]>.status_code
=========================== short test summary info ============================
FAILED tests/integration/test_client_rag.py::TestClientRAGEndpoints::test_embedding_models_endpoint - AssertionError: assert 'transformers_js' in {'source': 'Hugging Face Transformers.js', 'models': [{'id': 'Xenova/all-MiniLM-L6-v2', 'name': 'all-MiniLM-L6-v2', 'description': 'Fast, lightweight (22MB)', 'size_mb': 22, 'dimensions': 384, 'category': 'speed', 'languages': ['en'], 'recommended': True}, {'id': 'Xenova/all-mpnet-base-v2', 'name': 'all-mpnet-base-v2', 'description': 'Better quality (80MB)', 'size_mb': 80, 'dimensions': 768, 'category': 'quality', 'languages': ['en']}, {'id': 'Xenova/bge-small-en-v1.5', 'name': 'BGE-small-en-v1.5', 'description': 'Fast, good quality (33MB)', 'size_mb': 33, 'dimensions': 384, 'category': 'speed', 'languages': ['en']}, {'id': 'Xenova/bge-base-en-v1.5', 'name': 'BGE-base-en-v1.5', 'description': 'High quality (109MB)', 'size_mb': 109, 'dimensions': 768, 'category': 'quality', 'languages': ['en']}, {'id': 'Xenova/gte-small', 'name': 'GTE-small', 'description': 'Multilingual (33MB)', 'size_mb': 33, 'dimensions': 384, 'category': 'multilingual', 'languages': ['multi']}, {'id': 'Xenova/multilingual-e5-small', 'name': 'E5-small-multilingual', 'description': 'Best multilingual (118MB)', 'size_mb': 118, 'dimensions': 384, 'category': 'multilingual', 'languages': ['multi']}, {'id': 'Xenova/paraphrase-multilingual-MiniLM-L12-v2', 'name': 'Paraphrase-multilingual-MiniLM', 'description': 'Multilingual paraphrase (118MB)', 'size_mb': 118, 'dimensions': 384, 'category': 'multilingual', 'languages': ['multi']}, {'id': 'Xenova/gte-base', 'name': 'GTE-base', 'description': 'Better multilingual (218MB)', 'size_mb': 218, 'dimensions': 768, 'category': 'multilingual', 'languages': ['multi']}]}
FAILED tests/integration/test_client_rag.py::TestClientRAGEndpoints::test_embedding_model_categories - KeyError: 'transformers_js'
FAILED tests/integration/test_client_rag.py::TestLocalModeRAGUI::test_local_mode_rag_scripts - assert ('rag.js' in '<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>DualMind AI - Local Mode</title>\n    \n    <!-- External Libraries -->\n    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/core.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/javascript.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/python.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/java.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/cpp.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/xml.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/css.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/json.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/bash.min.js"></script>\n    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css">\n    \n    <!-- DualMind Styles -->\n    <link rel="stylesheet" href="/static/css/local.css">\n    \n    <!-- Initialize WebLLM and Transformers.js -->\n    <script type="module">\n        import { CreateMLCEngine } from "https://esm.run/@mlc-ai/web-llm";\n        window.CreateMLCEngine = CreateMLCEngine;\n        \n        import { pipeline, env } from \'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.1\';\n        env.allowLocalModels = false;\n        window.transformers = { pipeline, env };\n        \n        // Configure marked for code highlighting\n        marked.setOptions({\n            highlight: function(code, lang) {\n                if (lang && hljs.getLanguage(lang)) {\n                    try {\n                        return hljs.highlight(code, { language: lang }).value;\n                    } catch (err) {}\n                }\n                return hljs.highlightAuto(code).value;\n            },\n            breaks: true,\n            gfm: true\n        });\n    </script>\n</head>\n<body>\n    <div class="app-container">\n        <!-- Sidebar -->\n        <div class="sidebar">\n            <div class="sidebar-header">\n                <button class="new-chat-btn" onclick="dualmind.openNewChatModal()" title="Create new chat">\n                    <span>\U0001f4ac</span>\n                    <span>New chat</span>\n                </button>\n            </div>\n            \n            <div class="chat-history">\n                <div class="chat-history-title">Your chats</div>\n                <div id="chatHistoryList"></div>\n            </div>\n            \n            <div class="sidebar-footer">\n                <div class="user-avatar">DM</div>\n                <div class="user-name">DualMind User</div>\n            </div>\n        </div>\n        \n        <!-- Main Content -->\n        <div class="main-content">\n            <!-- Header -->\n            <div class="chat-header">\n                <div class="model-selector" onclick="dualmind.openModelSelector()">\n                    <div class="model-icon">\U0001f916</div>\n                    <div class="model-info">\n                        <h3 id="currentModelName">Select Model</h3>\n                        <p id="currentModelDesc">Click to choose a model</p>\n                    </div>\n                </div>\n                \n                <div class="header-actions">\n                    <button class="header-btn" onclick="dualmind.openSettings()" title="Settings">\u2699\ufe0f</button>\n                    <button class="header-btn" onclick="dualmind.exportChat()" title="Export">\u2b07\ufe0f</button>\n                    <button class="header-btn" onclick="dualmind.switchToCloudMode()" title="Cloud Mode">\u2601\ufe0f</button>\n                </div>\n            </div>\n            \n            <!-- Messages -->\n            <div class="chat-messages" id="chatMessages">\n                <div class="empty-state">\n                    <div class="empty-state-icon">\U0001f4ac</div>\n                    <h1>How can I help you today?</h1>\n                    <p>Select a model to start chatting. Your AI runs privately in your browser with no data sent to servers.</p>\n                </div>\n            </div>\n            \n            <!-- Input -->\n            <div class="chat-input-container">\n                <div class="input-wrapper">\n                    <span class="attach-icon" onclick="dualmind.openKnowledgeBase()" title="Add documents">\U0001f4ce</span>\n                    <textarea \n                        class="chat-input" \n                        id="userInput" \n                        placeholder="Enter your prompt here"\n                        rows="1"\n                    ></textarea>\n                    <div class="input-actions">\n                        <button class="input-btn" id="voiceBtn" onclick="dualmind.toggleVoice()" title="Voice input">\U0001f3a4</button>\n                        <button class="input-btn primary" id="sendBtn" onclick="dualmind.sendMessage()" disabled title="Send">\u27a4</button>\n                    </div>\n                </div>\n                <div class="input-hint">\n                    Press Enter to send, Shift+Enter for new line\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- Model Selector Modal -->\n    <div class="modal" id="modelModal">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h2>Select Model</h2>\n                <button class="close-modal" onclick="dualmind.closeModelSelector()">\xd7</button>\n            </div>\n            <div class="model-list" id="modelList"></div>\n        </div>\n    </div>\n    \n    <!-- Knowledge Base Modal -->\n    <div class="modal" id="knowledgeModal">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h2>\U0001f4da Knowledge Base</h2>\n                <button class="close-modal" onclick="dualmind.closeKnowledgeBase()">\xd7</button>\n            </div>\n            <div id="knowledgeContent">\n                <p style="color: #999; margin-bottom: 16px;">\n                    Upload documents to enhance AI responses with your own data.\n                </p>\n                <input type="file" id="fileInput" multiple style="display: none;" \n                       onchange="dualmind.handleFileUpload(event)">\n                <button class="new-chat-btn" onclick="document.getElementById(\'fileInput\').click()">\n                    \U0001f4c4 Upload Documents\n                </button>\n                <div id="uploadedFiles" style="margin-top: 16px;"></div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- Settings Modal -->\n    <div class="modal" id="settingsModal">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h2>\u2699\ufe0f Settings</h2>\n                <button class="close-modal" onclick="dualmind.closeSettings()">\xd7</button>\n            </div>\n            <div class="settings-content">\n                <div class="setting-group">\n                    <label class="setting-label">\n                        <span>\U0001f319 Dark Mode</span>\n                        <label class="switch">\n                            <input type="checkbox" id="darkModeToggle" onchange="dualmind.toggleDarkMode()">\n                            <span class="slider"></span>\n                        </label>\n                    </label>\n                </div>\n                \n                <div class="setting-group">\n                    <label class="setting-label">\U0001f4ad Custom Memory</label>\n                    <textarea \n                        id="customMemoryInput" \n                        class="setting-textarea"\n                        placeholder="Add custom instructions that will be included in every conversation (e.g., \'You are a helpful coding assistant\')"\n                        rows="4"\n                    ></textarea>\n                    <button class="save-btn" onclick="dualmind.saveCustomMemory()">\U0001f4be Save Memory</button>\n                </div>\n                \n                <div class="setting-group">\n                    <label class="setting-label">\U0001f4c1 Chat Context (Current Chat)</label>\n                    <textarea \n                        id="chatContextInput" \n                        class="setting-textarea"\n                        placeholder="Add context/instructions specific to this chat (e.g., \'Focus on Python programming\')"\n                        rows="3"\n                    ></textarea>\n                    <button class="save-btn" onclick="dualmind.saveChatContext()">\U0001f4be Save Context</button>\n                    <p style="font-size: 12px; color: #999; margin-top: 8px;">\n                        This context applies only to the current chat session\n                    </p>\n                </div>\n                \n                <div class="setting-group">\n                    <button class="danger-btn" onclick="dualmind.clearAllChats()">\n                        \U0001f5d1\ufe0f Clear All Chat History\n                    </button>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- Chat Actions Menu (Context Menu) -->\n    <div class="context-menu" id="chatContextMenu" style="display: none;">\n        <button class="context-menu-item" onclick="dualmind.renameChatPrompt()">\u270f\ufe0f Rename</button>\n        <button class="context-menu-item" onclick="dualmind.deleteChatPrompt()">\U0001f5d1\ufe0f Delete</button>\n    </div>\n    \n    <!-- New Chat Modal -->\n    <div class="modal" id="newChatModal">\n        <div class="modal-content small">\n            <div class="modal-header">\n                <h2>\U0001f4ac New Chat</h2>\n                <button class="close-modal" onclick="dualmind.closeNewChatModal()">\xd7</button>\n            </div>\n            <div style="padding: 20px;">\n                <label class="setting-label">Chat Name (Optional)</label>\n                <input \n                    type="text" \n                    id="newChatNameInput" \n                    class="chat-name-input"\n                    placeholder="Leave empty to use first message"\n                    style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px;"\n                >\n                <div style="display: flex; gap: 10px; margin-top: 20px;">\n                    <button class="save-btn" onclick="dualmind.createNewChat()">\u2705 Create</button>\n                    <button class="cancel-btn" onclick="dualmind.closeNewChatModal()">\u274c Cancel</button>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- DualMind Application -->\n    <script type="module" src="/static/js/app.js"></script>\n</body>\n</html>\n\n' or 'rag' in '<!doctype html>\n<html lang="en">\n<head>\n    <meta charset="utf-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>dualmind ai - local mode</title>\n    \n    <!-- external libraries -->\n    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/core.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/javascript.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/python.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/java.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/cpp.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/xml.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/css.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/json.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/bash.min.js"></script>\n    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css">\n    \n    <!-- dualmind styles -->\n    <link rel="stylesheet" href="/static/css/local.css">\n    \n    <!-- initialize webllm and transformers.js -->\n    <script type="module">\n        import { createmlcengine } from "https://esm.run/@mlc-ai/web-llm";\n        window.createmlcengine = createmlcengine;\n        \n        import { pipeline, env } from \'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.1\';\n        env.allowlocalmodels = false;\n        window.transformers = { pipeline, env };\n        \n        // configure marked for code highlighting\n        marked.setoptions({\n            highlight: function(code, lang) {\n                if (lang && hljs.getlanguage(lang)) {\n                    try {\n                        return hljs.highlight(code, { language: lang }).value;\n                    } catch (err) {}\n                }\n                return hljs.highlightauto(code).value;\n            },\n            breaks: true,\n            gfm: true\n        });\n    </script>\n</head>\n<body>\n    <div class="app-container">\n        <!-- sidebar -->\n        <div class="sidebar">\n            <div class="sidebar-header">\n                <button class="new-chat-btn" onclick="dualmind.opennewchatmodal()" title="create new chat">\n                    <span>\U0001f4ac</span>\n                    <span>new chat</span>\n                </button>\n            </div>\n            \n            <div class="chat-history">\n                <div class="chat-history-title">your chats</div>\n                <div id="chathistorylist"></div>\n            </div>\n            \n            <div class="sidebar-footer">\n                <div class="user-avatar">dm</div>\n                <div class="user-name">dualmind user</div>\n            </div>\n        </div>\n        \n        <!-- main content -->\n        <div class="main-content">\n            <!-- header -->\n            <div class="chat-header">\n                <div class="model-selector" onclick="dualmind.openmodelselector()">\n                    <div class="model-icon">\U0001f916</div>\n                    <div class="model-info">\n                        <h3 id="currentmodelname">select model</h3>\n                        <p id="currentmodeldesc">click to choose a model</p>\n                    </div>\n                </div>\n                \n                <div class="header-actions">\n                    <button class="header-btn" onclick="dualmind.opensettings()" title="settings">\u2699\ufe0f</button>\n                    <button class="header-btn" onclick="dualmind.exportchat()" title="export">\u2b07\ufe0f</button>\n                    <button class="header-btn" onclick="dualmind.switchtocloudmode()" title="cloud mode">\u2601\ufe0f</button>\n                </div>\n            </div>\n            \n            <!-- messages -->\n            <div class="chat-messages" id="chatmessages">\n                <div class="empty-state">\n                    <div class="empty-state-icon">\U0001f4ac</div>\n                    <h1>how can i help you today?</h1>\n                    <p>select a model to start chatting. your ai runs privately in your browser with no data sent to servers.</p>\n                </div>\n            </div>\n            \n            <!-- input -->\n            <div class="chat-input-container">\n                <div class="input-wrapper">\n                    <span class="attach-icon" onclick="dualmind.openknowledgebase()" title="add documents">\U0001f4ce</span>\n                    <textarea \n                        class="chat-input" \n                        id="userinput" \n                        placeholder="enter your prompt here"\n                        rows="1"\n                    ></textarea>\n                    <div class="input-actions">\n                        <button class="input-btn" id="voicebtn" onclick="dualmind.togglevoice()" title="voice input">\U0001f3a4</button>\n                        <button class="input-btn primary" id="sendbtn" onclick="dualmind.sendmessage()" disabled title="send">\u27a4</button>\n                    </div>\n                </div>\n                <div class="input-hint">\n                    press enter to send, shift+enter for new line\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- model selector modal -->\n    <div class="modal" id="modelmodal">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h2>select model</h2>\n                <button class="close-modal" onclick="dualmind.closemodelselector()">\xd7</button>\n            </div>\n            <div class="model-list" id="modellist"></div>\n        </div>\n    </div>\n    \n    <!-- knowledge base modal -->\n    <div class="modal" id="knowledgemodal">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h2>\U0001f4da knowledge base</h2>\n                <button class="close-modal" onclick="dualmind.closeknowledgebase()">\xd7</button>\n            </div>\n            <div id="knowledgecontent">\n                <p style="color: #999; margin-bottom: 16px;">\n                    upload documents to enhance ai responses with your own data.\n                </p>\n                <input type="file" id="fileinput" multiple style="display: none;" \n                       onchange="dualmind.handlefileupload(event)">\n                <button class="new-chat-btn" onclick="document.getelementbyid(\'fileinput\').click()">\n                    \U0001f4c4 upload documents\n                </button>\n                <div id="uploadedfiles" style="margin-top: 16px;"></div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- settings modal -->\n    <div class="modal" id="settingsmodal">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h2>\u2699\ufe0f settings</h2>\n                <button class="close-modal" onclick="dualmind.closesettings()">\xd7</button>\n            </div>\n            <div class="settings-content">\n                <div class="setting-group">\n                    <label class="setting-label">\n                        <span>\U0001f319 dark mode</span>\n                        <label class="switch">\n                            <input type="checkbox" id="darkmodetoggle" onchange="dualmind.toggledarkmode()">\n                            <span class="slider"></span>\n                        </label>\n                    </label>\n                </div>\n                \n                <div class="setting-group">\n                    <label class="setting-label">\U0001f4ad custom memory</label>\n                    <textarea \n                        id="custommemoryinput" \n                        class="setting-textarea"\n                        placeholder="add custom instructions that will be included in every conversation (e.g., \'you are a helpful coding assistant\')"\n                        rows="4"\n                    ></textarea>\n                    <button class="save-btn" onclick="dualmind.savecustommemory()">\U0001f4be save memory</button>\n                </div>\n                \n                <div class="setting-group">\n                    <label class="setting-label">\U0001f4c1 chat context (current chat)</label>\n                    <textarea \n                        id="chatcontextinput" \n                        class="setting-textarea"\n                        placeholder="add context/instructions specific to this chat (e.g., \'focus on python programming\')"\n                        rows="3"\n                    ></textarea>\n                    <button class="save-btn" onclick="dualmind.savechatcontext()">\U0001f4be save context</button>\n                    <p style="font-size: 12px; color: #999; margin-top: 8px;">\n                        this context applies only to the current chat session\n                    </p>\n                </div>\n                \n                <div class="setting-group">\n                    <button class="danger-btn" onclick="dualmind.clearallchats()">\n                        \U0001f5d1\ufe0f clear all chat history\n                    </button>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- chat actions menu (context menu) -->\n    <div class="context-menu" id="chatcontextmenu" style="display: none;">\n        <button class="context-menu-item" onclick="dualmind.renamechatprompt()">\u270f\ufe0f rename</button>\n        <button class="context-menu-item" onclick="dualmind.deletechatprompt()">\U0001f5d1\ufe0f delete</button>\n    </div>\n    \n    <!-- new chat modal -->\n    <div class="modal" id="newchatmodal">\n        <div class="modal-content small">\n            <div class="modal-header">\n                <h2>\U0001f4ac new chat</h2>\n                <button class="close-modal" onclick="dualmind.closenewchatmodal()">\xd7</button>\n            </div>\n            <div style="padding: 20px;">\n                <label class="setting-label">chat name (optional)</label>\n                <input \n                    type="text" \n                    id="newchatnameinput" \n                    class="chat-name-input"\n                    placeholder="leave empty to use first message"\n                    style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px;"\n                >\n                <div style="display: flex; gap: 10px; margin-top: 20px;">\n                    <button class="save-btn" onclick="dualmind.createnewchat()">\u2705 create</button>\n                    <button class="cancel-btn" onclick="dualmind.closenewchatmodal()">\u274c cancel</button>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- dualmind application -->\n    <script type="module" src="/static/js/app.js"></script>\n</body>\n</html>\n\n')
 +  where '<!doctype html>\n<html lang="en">\n<head>\n    <meta charset="utf-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>dualmind ai - local mode</title>\n    \n    <!-- external libraries -->\n    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/core.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/javascript.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/python.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/java.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/cpp.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/xml.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/css.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/json.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/bash.min.js"></script>\n    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css">\n    \n    <!-- dualmind styles -->\n    <link rel="stylesheet" href="/static/css/local.css">\n    \n    <!-- initialize webllm and transformers.js -->\n    <script type="module">\n        import { createmlcengine } from "https://esm.run/@mlc-ai/web-llm";\n        window.createmlcengine = createmlcengine;\n        \n        import { pipeline, env } from \'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.1\';\n        env.allowlocalmodels = false;\n        window.transformers = { pipeline, env };\n        \n        // configure marked for code highlighting\n        marked.setoptions({\n            highlight: function(code, lang) {\n                if (lang && hljs.getlanguage(lang)) {\n                    try {\n                        return hljs.highlight(code, { language: lang }).value;\n                    } catch (err) {}\n                }\n                return hljs.highlightauto(code).value;\n            },\n            breaks: true,\n            gfm: true\n        });\n    </script>\n</head>\n<body>\n    <div class="app-container">\n        <!-- sidebar -->\n        <div class="sidebar">\n            <div class="sidebar-header">\n                <button class="new-chat-btn" onclick="dualmind.opennewchatmodal()" title="create new chat">\n                    <span>\U0001f4ac</span>\n                    <span>new chat</span>\n                </button>\n            </div>\n            \n            <div class="chat-history">\n                <div class="chat-history-title">your chats</div>\n                <div id="chathistorylist"></div>\n            </div>\n            \n            <div class="sidebar-footer">\n                <div class="user-avatar">dm</div>\n                <div class="user-name">dualmind user</div>\n            </div>\n        </div>\n        \n        <!-- main content -->\n        <div class="main-content">\n            <!-- header -->\n            <div class="chat-header">\n                <div class="model-selector" onclick="dualmind.openmodelselector()">\n                    <div class="model-icon">\U0001f916</div>\n                    <div class="model-info">\n                        <h3 id="currentmodelname">select model</h3>\n                        <p id="currentmodeldesc">click to choose a model</p>\n                    </div>\n                </div>\n                \n                <div class="header-actions">\n                    <button class="header-btn" onclick="dualmind.opensettings()" title="settings">\u2699\ufe0f</button>\n                    <button class="header-btn" onclick="dualmind.exportchat()" title="export">\u2b07\ufe0f</button>\n                    <button class="header-btn" onclick="dualmind.switchtocloudmode()" title="cloud mode">\u2601\ufe0f</button>\n                </div>\n            </div>\n            \n            <!-- messages -->\n            <div class="chat-messages" id="chatmessages">\n                <div class="empty-state">\n                    <div class="empty-state-icon">\U0001f4ac</div>\n                    <h1>how can i help you today?</h1>\n                    <p>select a model to start chatting. your ai runs privately in your browser with no data sent to servers.</p>\n                </div>\n            </div>\n            \n            <!-- input -->\n            <div class="chat-input-container">\n                <div class="input-wrapper">\n                    <span class="attach-icon" onclick="dualmind.openknowledgebase()" title="add documents">\U0001f4ce</span>\n                    <textarea \n                        class="chat-input" \n                        id="userinput" \n                        placeholder="enter your prompt here"\n                        rows="1"\n                    ></textarea>\n                    <div class="input-actions">\n                        <button class="input-btn" id="voicebtn" onclick="dualmind.togglevoice()" title="voice input">\U0001f3a4</button>\n                        <button class="input-btn primary" id="sendbtn" onclick="dualmind.sendmessage()" disabled title="send">\u27a4</button>\n                    </div>\n                </div>\n                <div class="input-hint">\n                    press enter to send, shift+enter for new line\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- model selector modal -->\n    <div class="modal" id="modelmodal">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h2>select model</h2>\n                <button class="close-modal" onclick="dualmind.closemodelselector()">\xd7</button>\n            </div>\n            <div class="model-list" id="modellist"></div>\n        </div>\n    </div>\n    \n    <!-- knowledge base modal -->\n    <div class="modal" id="knowledgemodal">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h2>\U0001f4da knowledge base</h2>\n                <button class="close-modal" onclick="dualmind.closeknowledgebase()">\xd7</button>\n            </div>\n            <div id="knowledgecontent">\n                <p style="color: #999; margin-bottom: 16px;">\n                    upload documents to enhance ai responses with your own data.\n                </p>\n                <input type="file" id="fileinput" multiple style="display: none;" \n                       onchange="dualmind.handlefileupload(event)">\n                <button class="new-chat-btn" onclick="document.getelementbyid(\'fileinput\').click()">\n                    \U0001f4c4 upload documents\n                </button>\n                <div id="uploadedfiles" style="margin-top: 16px;"></div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- settings modal -->\n    <div class="modal" id="settingsmodal">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h2>\u2699\ufe0f settings</h2>\n                <button class="close-modal" onclick="dualmind.closesettings()">\xd7</button>\n            </div>\n            <div class="settings-content">\n                <div class="setting-group">\n                    <label class="setting-label">\n                        <span>\U0001f319 dark mode</span>\n                        <label class="switch">\n                            <input type="checkbox" id="darkmodetoggle" onchange="dualmind.toggledarkmode()">\n                            <span class="slider"></span>\n                        </label>\n                    </label>\n                </div>\n                \n                <div class="setting-group">\n                    <label class="setting-label">\U0001f4ad custom memory</label>\n                    <textarea \n                        id="custommemoryinput" \n                        class="setting-textarea"\n                        placeholder="add custom instructions that will be included in every conversation (e.g., \'you are a helpful coding assistant\')"\n                        rows="4"\n                    ></textarea>\n                    <button class="save-btn" onclick="dualmind.savecustommemory()">\U0001f4be save memory</button>\n                </div>\n                \n                <div class="setting-group">\n                    <label class="setting-label">\U0001f4c1 chat context (current chat)</label>\n                    <textarea \n                        id="chatcontextinput" \n                        class="setting-textarea"\n                        placeholder="add context/instructions specific to this chat (e.g., \'focus on python programming\')"\n                        rows="3"\n                    ></textarea>\n                    <button class="save-btn" onclick="dualmind.savechatcontext()">\U0001f4be save context</button>\n                    <p style="font-size: 12px; color: #999; margin-top: 8px;">\n                        this context applies only to the current chat session\n                    </p>\n                </div>\n                \n                <div class="setting-group">\n                    <button class="danger-btn" onclick="dualmind.clearallchats()">\n                        \U0001f5d1\ufe0f clear all chat history\n                    </button>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- chat actions menu (context menu) -->\n    <div class="context-menu" id="chatcontextmenu" style="display: none;">\n        <button class="context-menu-item" onclick="dualmind.renamechatprompt()">\u270f\ufe0f rename</button>\n        <button class="context-menu-item" onclick="dualmind.deletechatprompt()">\U0001f5d1\ufe0f delete</button>\n    </div>\n    \n    <!-- new chat modal -->\n    <div class="modal" id="newchatmodal">\n        <div class="modal-content small">\n            <div class="modal-header">\n                <h2>\U0001f4ac new chat</h2>\n                <button class="close-modal" onclick="dualmind.closenewchatmodal()">\xd7</button>\n            </div>\n            <div style="padding: 20px;">\n                <label class="setting-label">chat name (optional)</label>\n                <input \n                    type="text" \n                    id="newchatnameinput" \n                    class="chat-name-input"\n                    placeholder="leave empty to use first message"\n                    style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px;"\n                >\n                <div style="display: flex; gap: 10px; margin-top: 20px;">\n                    <button class="save-btn" onclick="dualmind.createnewchat()">\u2705 create</button>\n                    <button class="cancel-btn" onclick="dualmind.closenewchatmodal()">\u274c cancel</button>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- dualmind application -->\n    <script type="module" src="/static/js/app.js"></script>\n</body>\n</html>\n\n' = <built-in method lower of str object at 0x952b54000>()
 +    where <built-in method lower of str object at 0x952b54000> = '<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>DualMind AI - Local Mode</title>\n    \n    <!-- External Libraries -->\n    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/core.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/javascript.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/python.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/java.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/cpp.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/xml.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/css.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/json.min.js"></script>\n    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/bash.min.js"></script>\n    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css">\n    \n    <!-- DualMind Styles -->\n    <link rel="stylesheet" href="/static/css/local.css">\n    \n    <!-- Initialize WebLLM and Transformers.js -->\n    <script type="module">\n        import { CreateMLCEngine } from "https://esm.run/@mlc-ai/web-llm";\n        window.CreateMLCEngine = CreateMLCEngine;\n        \n        import { pipeline, env } from \'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.1\';\n        env.allowLocalModels = false;\n        window.transformers = { pipeline, env };\n        \n        // Configure marked for code highlighting\n        marked.setOptions({\n            highlight: function(code, lang) {\n                if (lang && hljs.getLanguage(lang)) {\n                    try {\n                        return hljs.highlight(code, { language: lang }).value;\n                    } catch (err) {}\n                }\n                return hljs.highlightAuto(code).value;\n            },\n            breaks: true,\n            gfm: true\n        });\n    </script>\n</head>\n<body>\n    <div class="app-container">\n        <!-- Sidebar -->\n        <div class="sidebar">\n            <div class="sidebar-header">\n                <button class="new-chat-btn" onclick="dualmind.openNewChatModal()" title="Create new chat">\n                    <span>\U0001f4ac</span>\n                    <span>New chat</span>\n                </button>\n            </div>\n            \n            <div class="chat-history">\n                <div class="chat-history-title">Your chats</div>\n                <div id="chatHistoryList"></div>\n            </div>\n            \n            <div class="sidebar-footer">\n                <div class="user-avatar">DM</div>\n                <div class="user-name">DualMind User</div>\n            </div>\n        </div>\n        \n        <!-- Main Content -->\n        <div class="main-content">\n            <!-- Header -->\n            <div class="chat-header">\n                <div class="model-selector" onclick="dualmind.openModelSelector()">\n                    <div class="model-icon">\U0001f916</div>\n                    <div class="model-info">\n                        <h3 id="currentModelName">Select Model</h3>\n                        <p id="currentModelDesc">Click to choose a model</p>\n                    </div>\n                </div>\n                \n                <div class="header-actions">\n                    <button class="header-btn" onclick="dualmind.openSettings()" title="Settings">\u2699\ufe0f</button>\n                    <button class="header-btn" onclick="dualmind.exportChat()" title="Export">\u2b07\ufe0f</button>\n                    <button class="header-btn" onclick="dualmind.switchToCloudMode()" title="Cloud Mode">\u2601\ufe0f</button>\n                </div>\n            </div>\n            \n            <!-- Messages -->\n            <div class="chat-messages" id="chatMessages">\n                <div class="empty-state">\n                    <div class="empty-state-icon">\U0001f4ac</div>\n                    <h1>How can I help you today?</h1>\n                    <p>Select a model to start chatting. Your AI runs privately in your browser with no data sent to servers.</p>\n                </div>\n            </div>\n            \n            <!-- Input -->\n            <div class="chat-input-container">\n                <div class="input-wrapper">\n                    <span class="attach-icon" onclick="dualmind.openKnowledgeBase()" title="Add documents">\U0001f4ce</span>\n                    <textarea \n                        class="chat-input" \n                        id="userInput" \n                        placeholder="Enter your prompt here"\n                        rows="1"\n                    ></textarea>\n                    <div class="input-actions">\n                        <button class="input-btn" id="voiceBtn" onclick="dualmind.toggleVoice()" title="Voice input">\U0001f3a4</button>\n                        <button class="input-btn primary" id="sendBtn" onclick="dualmind.sendMessage()" disabled title="Send">\u27a4</button>\n                    </div>\n                </div>\n                <div class="input-hint">\n                    Press Enter to send, Shift+Enter for new line\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- Model Selector Modal -->\n    <div class="modal" id="modelModal">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h2>Select Model</h2>\n                <button class="close-modal" onclick="dualmind.closeModelSelector()">\xd7</button>\n            </div>\n            <div class="model-list" id="modelList"></div>\n        </div>\n    </div>\n    \n    <!-- Knowledge Base Modal -->\n    <div class="modal" id="knowledgeModal">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h2>\U0001f4da Knowledge Base</h2>\n                <button class="close-modal" onclick="dualmind.closeKnowledgeBase()">\xd7</button>\n            </div>\n            <div id="knowledgeContent">\n                <p style="color: #999; margin-bottom: 16px;">\n                    Upload documents to enhance AI responses with your own data.\n                </p>\n                <input type="file" id="fileInput" multiple style="display: none;" \n                       onchange="dualmind.handleFileUpload(event)">\n                <button class="new-chat-btn" onclick="document.getElementById(\'fileInput\').click()">\n                    \U0001f4c4 Upload Documents\n                </button>\n                <div id="uploadedFiles" style="margin-top: 16px;"></div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- Settings Modal -->\n    <div class="modal" id="settingsModal">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h2>\u2699\ufe0f Settings</h2>\n                <button class="close-modal" onclick="dualmind.closeSettings()">\xd7</button>\n            </div>\n            <div class="settings-content">\n                <div class="setting-group">\n                    <label class="setting-label">\n                        <span>\U0001f319 Dark Mode</span>\n                        <label class="switch">\n                            <input type="checkbox" id="darkModeToggle" onchange="dualmind.toggleDarkMode()">\n                            <span class="slider"></span>\n                        </label>\n                    </label>\n                </div>\n                \n                <div class="setting-group">\n                    <label class="setting-label">\U0001f4ad Custom Memory</label>\n                    <textarea \n                        id="customMemoryInput" \n                        class="setting-textarea"\n                        placeholder="Add custom instructions that will be included in every conversation (e.g., \'You are a helpful coding assistant\')"\n                        rows="4"\n                    ></textarea>\n                    <button class="save-btn" onclick="dualmind.saveCustomMemory()">\U0001f4be Save Memory</button>\n                </div>\n                \n                <div class="setting-group">\n                    <label class="setting-label">\U0001f4c1 Chat Context (Current Chat)</label>\n                    <textarea \n                        id="chatContextInput" \n                        class="setting-textarea"\n                        placeholder="Add context/instructions specific to this chat (e.g., \'Focus on Python programming\')"\n                        rows="3"\n                    ></textarea>\n                    <button class="save-btn" onclick="dualmind.saveChatContext()">\U0001f4be Save Context</button>\n                    <p style="font-size: 12px; color: #999; margin-top: 8px;">\n                        This context applies only to the current chat session\n                    </p>\n                </div>\n                \n                <div class="setting-group">\n                    <button class="danger-btn" onclick="dualmind.clearAllChats()">\n                        \U0001f5d1\ufe0f Clear All Chat History\n                    </button>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- Chat Actions Menu (Context Menu) -->\n    <div class="context-menu" id="chatContextMenu" style="display: none;">\n        <button class="context-menu-item" onclick="dualmind.renameChatPrompt()">\u270f\ufe0f Rename</button>\n        <button class="context-menu-item" onclick="dualmind.deleteChatPrompt()">\U0001f5d1\ufe0f Delete</button>\n    </div>\n    \n    <!-- New Chat Modal -->\n    <div class="modal" id="newChatModal">\n        <div class="modal-content small">\n            <div class="modal-header">\n                <h2>\U0001f4ac New Chat</h2>\n                <button class="close-modal" onclick="dualmind.closeNewChatModal()">\xd7</button>\n            </div>\n            <div style="padding: 20px;">\n                <label class="setting-label">Chat Name (Optional)</label>\n                <input \n                    type="text" \n                    id="newChatNameInput" \n                    class="chat-name-input"\n                    placeholder="Leave empty to use first message"\n                    style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px;"\n                >\n                <div style="display: flex; gap: 10px; margin-top: 20px;">\n                    <button class="save-btn" onclick="dualmind.createNewChat()">\u2705 Create</button>\n                    <button class="cancel-btn" onclick="dualmind.closeNewChatModal()">\u274c Cancel</button>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- DualMind Application -->\n    <script type="module" src="/static/js/app.js"></script>\n</body>\n</html>\n\n'.lower
FAILED tests/integration/test_client_rag.py::TestRAGUserFlow::test_embedding_model_selection_flow - KeyError: 'transformers_js'
FAILED tests/unit/test_server.py::TestChatEndpoint::test_chat_missing_api_key - assert 422 in [400, 401, 500]
 +  where 422 = <Response [422 Unprocessable Entity]>.status_code
FAILED tests/unit/test_server.py::TestChatEndpoint::test_chat_invalid_provider - assert 200 in [400, 500]
 +  where 200 = <Response [200 OK]>.status_code
========================= 6 failed, 68 passed in 3.46s =========================
